<script src="//maps.google.com/maps/api/js?v=3.18&sensor=false&client=&key=&libraries=geometry&language=&hl=&region="></script> 
<script src="//google-maps-utility-library-v3.googlecode.com/svn/tags/markerclustererplus/2.0.14/src/markerclusterer_packed.js"></script>
<script src='//google-maps-utility-library-v3.googlecode.com/svn/tags/infobox/1.1.9/src/infobox_packed.js' type='text/javascript'></script> <!-- only if you need custom infoboxes -->


<div class="row page-title">
    <div class="container clear-padding text-center">
      <h3><%= @apartment.title  %> </h3>

      <%if @apartment.state=="unpublished_unrented"%>
        <h4>PROPIEDAD NO DISPONIBLE</h4>
      <%end%>

       <%if @apartment.state=="unpublished_rented"%>
        <h4>ESTA PROPIEDAD FUE ARRENDADA</h4>
      <%end%>
      <!--
      <h5>
        <i class="fa fa-star"></i>
        <i class="fa fa-star"></i>
        <i class="fa fa-star"></i>
        <i class="fa fa-star"></i>
        <i class="fa fa-star-o"></i>
      </h5>-->
    </div>
  </div>


  <!-- END: PAGE TITLE -->
  <div class="row">
    <div class="container" style="padding-top:20px">
      <div class="main-content col-md-8">
<h1>
<b class="boton">
        <%if can? :update, @apartment %>
            <%= link_to 'Editar', edit_apartment_path(@apartment), class: "btn btn-info" %>
            <%end%></b>
          <b>  <%if can? :destroy, @apartment %>
            <%= link_to 'Eliminar', @apartment, method: :delete, class: "btn btn-danger white", data: { confirm: '¿Estas seguro?' } %>
            <%end%></b></h1>    




          <!-- START: ROOM GALLERY -->
        <div id="myCarousel" class="carousel slide" data-ride="carousel">
          <!-- Carousel indicators -->
      <%if @apartment.pictures.count > 1 %>
        <ol class="carousel-indicators">
          <li data-target="#myCarousel" data-slide-to="0" class="active"></li>
          <%for i in 1..@apartment.pictures.count-1%>
            <li data-target="#myCarousel" data-slide-to=<%= "#{i}" %>></li>
          <%end%>
        </ol> 
      <%end%>
          <!-- Wrapper for carousel items -->
          <div class="carousel-inner">
            <%unless @apartment.pictures.empty?%>
                <% @apartment.pictures.each do |pic| %>
                  <%if pic == @apartment.pictures.first%>
                    <div class="active item">
                      <%= image_tag pic.image.url, class:"apartment-carousel" %>
                    </div>
                  <%else%>
                    <div class="item">
                      <%= image_tag pic.image.url, class:"apartment-carousel" %>
                    </div>
                  <% end %>
                <% end %>
            <%else%>
              <div class="active item">
                <%= image_tag("sinfoto.jpg", :alt => "No tiene foto", class:"apartment-carousel") %>
              </div>
            <%end%>
          </div>
          <!-- Carousel controls -->
          <%if @apartment.pictures.count > 1 %>
            <a id="carousel-arrows"class="carousel-control left" href="#myCarousel" data-slide="prev">
                <span class="glyphicon glyphicon-chevron-left"></span>
            </a>
            <a id="carousel-arrows" class="carousel-control right" href="#myCarousel" data-slide="next">
                <span class="glyphicon glyphicon-chevron-right"></span>
            </a>
          <%end%>
      </div>
        <!-- END: ROOM GALLERY -->
        <div class="room-ammenties">
          <div class="col-md-2 col-sm-2">
            <h4 class="custom-head">Detalles</h4>
          </div>
          <div class="col-md-10 col-sm-10 hotel-room-detail">
            <div class="ammenties-1">
              <div class="col-md-6 col-sm-6">
                <p><i class="fa fa-bed"></i>PIEZA(S): <%=@apartment.rooms%> </p>
              </div>
              <div class="col-md-6 col-sm-6">
                <p><i class="fa fa-tint"></i>BAÑO(S): <%=@apartment.bathrooms%></p>
              </div>
              <div class="col-md-6 col-sm-6">
                <p><i class="fa fa-usd"></i>PRECIO/DÍA: <%=@apartment.pernightPrice%> (USD)</p>
              </div>
               <div class="col-md-6 col-sm-6">
                <p><i class="fa fa-usd"></i>PRECIO RESERVA: <%=@apartment.reservePrice%> (USD)</p>
              </div>
            </div>
          </div>
        </div>
        <div class="hr-seperator"></div>
        <div class="hotel-room-desc">
          <div class="col-md-2 col-sm-2">
            <h4 class="custom-head">Descripción</h4>
          </div>
          <div class="col-md-10 col-sm-10 hotel-room-detail">
            <h5><%= @apartment.description%> </h5>
          </div>
        </div>

      </div>  
      <div class="col-md-4 hotel-detail-sidebar">
        <div class="col-md-12 sidebar-wrapper clear-padding">
          <div class="sidebar-booking-box" style="padding-top:20px">
            <h3 class="text-center">SIMULAR ARRIENDO</h3>
            <div class="booking-box-body">
              <form >
                <div class="col-md-12 col-sm-4 col-xs-4">
                  <label>CANTIDAD DE DÍAS: </label>
                  <select>
                    <option>1</option>
                    <option>2</option>
                    <option>3</option>
                    <option>4</option>
                    <option>5</option>
                    <option>6</option>
                    <option>7</option>
                    <option>8</option>
                    <option>9</option>
                    <option>10</option>
                  </select>
                </div>
                <div class="clearfix"></div>
                
                <div class="grand-total text-center">
                  <div class="col-md-6 col-sm-6 col-xs-6">
                    <h4>Total $599</h4>
                  </div>
                  <div class="col-md-6 col-sm-6 col-xs-6">
                    <button type="submit">SIMULAR</button>
                  </div>
                </div>
              </form>
              <div style="background-color:#00688D" class="grand-total text-center">
              <div>
  <%if user_signed_in?%>
  <%=render "payments/form", payment: Payment.new, apartment: @apartment%>
  <%end%>
</div>
 </div>
            </div>
          </div>
          <div class="sidebar-assistance-box">
            <h3 class="text-center">CONTACTO</h3>
            <div class="assistance-box-body text-center">
              <h5><%= @apartment.user.name %></h5>
              <h4><%= @apartment.user.email %></h4>
              <h4><%= @apartment.user.phone_number %></h4>
            </div>
          </div>
        </div>
      </div>
        <div class="col-md-12 hotel-room-desc">
          <div class="col-md-2 col-sm-2">
            <h4 class="custom-head">Ubicación</h4>
            <h3><%=@apartment.address%></h3>            
          </div>
          <div class="col-md-10 col-sm-10 hotel-room-detail">
            <div id="map" style='width: 100%; height: 300px;'></div>
  <script type="text/javascript">
    handler = Gmaps.build('Google');
    handler.buildMap({ provider: {}, internal: {id: 'map'}},
    function(){
      markers = handler.addMarkers(<%=raw @hash.to_json %>);
      handler.bounds.extendWith(markers);
      handler.fitMapToBounds();
      handler.getMap().setZoom(16);
    });
  </script>
          </div>
        </div>
    </div>
  </div>

  <!-- START: SIMILAR ROOMS -->
  <div class="row similar-room">
    <div class="container clear-padding">
      <div class="hotel-listing text-center">
        <h2>Propiedades cerca de esta:</h2>
        <!-- START: HOTEL GRID VIEW -->
        <%contador=0%><!--Propiedades que cumplen con las condiciones-->
        <div id="owl-demo">
        <%Apartment.publicados_sinArrrendar.each do |a|%>
        <%if a.geocoded?%>
        <%unless a.address==@apartment.address%>
        <%if @apartment.distance_from([a.latitude,a.longitude]) < 10%>
        <%contador+=1%>
        <div class="room-grid-view wow slideInUp">
        <%if a.pictures.empty? %>
          <div class="crop">
            <%= image_tag("sinfoto.jpg", :alt => "No tiene foto") %>
          </div>
        <%else%>
          <div class="crop">
            <%= image_tag a.pictures.first.image.url %>
          </div>
        <%end%>
          <div class="room-info">
            <div class="post-title">
              <h5><%=a.title%></h5>
              <p><i class="fa fa-calendar"></i> <%=a.created_at%></p>
              <p><i class="fa fa-map-signs"></i> <%=a.address%></p>
              <p><i class="fa fa-road"></i> <%=@apartment.distance_from([a.latitude,a.longitude]).round(2)%> (KM)</p>
            </div>
            <div class="post-desc">
              <p><%=a.description%></p>
            </div>
            <div class="room-book">
              <div class="col-md-8 col-sm-6 col-xs-6 clear-padding post-alt">
                <h5><i class="fa fa-comments"></i> 2 <i class="fa fa-share-alt"></i> 20 </h5>
              </div>
              <div class="col-md-4 col-sm-6 col-xs-6 clear-padding">
                <a href="#" class="text-center"><%=link_to "Ver",a%></a> 
              </div>
            </div>
            <div class="clearfix"></div>
          </div>
        </div>
        <%end%>
        <%end%>
        <%end%>
        <%end%>
      </div>   <!--FIN OWL-->
        <%if contador == 0%>
    <h4>Lo sentimos, recorrimos 10 kilometros alrededor de esta propiedad y no encontramos ninguna <i class="fa fa-thumbs-down"></i></h4>
  <%end%>
       <script>
    $(document).ready(function() {
      $("#owl-demo").owlCarousel({
          autoPlay: 3000, //Set AutoPlay to 3 seconds
          items : 3,
          itemsDesktop : [1199,3],
          itemsDesktopSmall : [979,3],
          loop: true
      });
    });
</script> 

<script>
  new WOW().init();
</script>
        <div class="clearfix-sm"></div>
        
      <!-- END: ROOM GRID VIEW -->
    </div> 
  </div>
 </div>  